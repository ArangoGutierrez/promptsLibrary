name: Validate Prompts

on:
  push:
    branches: [main]
    paths:
      - 'prompts/**/*.md'
  pull_request:
    branches: [main]
    paths:
      - 'prompts/**/*.md'

jobs:
  validate-structure:
    name: Validate Prompt Structure
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Check prompt structure
        run: |
          #!/bin/bash
          set -e
          
          ERRORS=0
          
          # Required sections for main prompts (not _compressed or _kickoff)
          REQUIRED_SECTIONS=("## ROLE" "## GOAL")
          
          echo "Validating prompt structure..."
          echo ""
          
          for file in prompts/*.md; do
            if [[ ! -f "$file" ]]; then
              continue
            fi
            
            filename=$(basename "$file")
            echo "Checking: $filename"
            
            for section in "${REQUIRED_SECTIONS[@]}"; do
              if ! grep -q "$section" "$file"; then
                echo "  ❌ Missing: $section"
                ERRORS=$((ERRORS + 1))
              else
                echo "  ✓ Found: $section"
              fi
            done
            echo ""
          done
          
          if [[ $ERRORS -gt 0 ]]; then
            echo "❌ Found $ERRORS missing sections"
            exit 1
          else
            echo "✅ All prompts have required sections"
          fi
